<!DOCTYPE html>
<html lang='en'>
<head>
  <link rel='icon'
        href='data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAACAhYcA////AA0PEAC+pm4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiIiIiIiIiIiIiIiIiIiMyISESIiIiIzIhIRIiIiIiIiEhEiIiIiIiISESIiIiIiIRIRIiIiIiIRIhEiIiIiERIiESIiIiIQIhESIiIiIiIRESIiIiIiEREiIiIiIiIRIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
        type='image/x-png'/>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
  <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.8.2/css/all.css'
        integrity='sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay' crossorigin='anonymous'>
  <title>bGeigieCast 1346 | Update firmware</title>
  <style>i {
    width: 25px;
    text-align: center;
  }

  #layout {
    max-width: 680px;
    margin: auto;
  }

  .pure-menu-link {
    padding: 1em .7em;
  }</style>
</head>
<body>
<div id='layout'>
  <div id='header'>
    <div class='pure-menu pure-menu-horizontal'><a href='/' class='pure-menu-heading'>bGeigieCast 1346</a>
      <ul class='pure-menu-list'>
        <li class='pure-menu-item pure-menu-has-children pure-menu-allow-hover'><a href='#' id='menuLink1'
                                                                                   class='pure-menu-link'><i
            class='fa fa-cog'></i>Configure</a>
          <ul class='pure-menu-children'>
            <li class='pure-menu-item'><a href='/device' class='pure-menu-link'><i class='fa fa-tablet'></i>Device</a>
            </li>
            <li class='pure-menu-item'><a href='/connection' class='pure-menu-link'><i class='fa fa-wifi'></i>Connection</a>
            </li>
            <li class='pure-menu-item'><a href='/location' class='pure-menu-link'><i class='fa fa-map-marker-alt'></i>Location</a>
            </li>
          </ul>
        </li>
        <li class='pure-menu-item'><a href='/update' class='pure-menu-link'><i class='fa fa-download'></i>Update
          firmware</a></li>
        <li class='pure-menu-item'><a href='https://github.com/Safecast/bGeigieCast/' class='pure-menu-link'><i
            class='fab fa-github'></i>Github</a></li>
      </ul>
    </div>
  </div>
  <div id='main'>
    <div id='update'>
      <form method='POST' action='#' enctype='multipart/form-data' id='upload_form'>
        <script>function sub(obj) {
            var fileName = obj.value.split('\\');
            document.getElementById('file-input').innerHTML = fileName[fileName.length - 1];
        };$('form').submit(function (e) {
            e.preventDefault();
            $('#form-content').hide();
            var form = $('#upload_form')[0];
            var data = new FormData(form);
            $.ajax({
                url: '/update', type: 'POST', data: data, contentType: false, processData: false, xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener('progress', function (evt) {
                        if (evt.lengthComputable) {
                            $('#status').html('Uploading new firmware... This can take up to 10 minutes.');
                            var per = evt.loaded / evt.total;
                            $('#prg').html('progress: ' + Math.round(per * 100) + '%');
                            $('#bar').css('width', Math.round(per * 100) + '%');
                        }
                    }, false);
                    return xhr;
                }, success: function (d, s) {
                    $('#status').html('Upload success! Restarting device to apply update.');
                    console.log('success!')
                }, error: function (a, b, c) {
                    $('#status').html('Upload failed... Try again or contact info@safecast.org')
                }
            });
        });</script>
        <p id='status'>Update the firmware</p>
        <div id='form-content'><input type='file' name='update' id='file' onchange='sub(this)' style=display:none><label
            id='file-input' for='file'>Choose file...</label><input type='submit' class=btn value='Update'></div>
        <br><br>
        <div id='prg'></div>
        <div id='prgbar'>
          <div id='bar'></div>
        </div>
      </form>
    </div>
  </div>
</div>
</body>
</html>